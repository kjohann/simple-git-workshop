# Git Workshop - Development Context

## Project Overview

TypeScript-based git workshop where participants run task setup scripts to practice git rebase operations locally. Each task creates its own isolated git repository for hands-on practice without requiring remote repositories.

## Architecture Decisions

### Functional Approach with Curried Operations

- **Pattern**: `createGitOps(git, repoPath)` returns object with bound operations
- **Why**: Minimal boilerplate, clean call sites, perfect for short-lived task scripts
- **Not using classes**: Each task script is a fresh process, no state persistence needed

### Atomic Operations

- Operations are small, composable functions (writeFile, addAll, commit)
- Task scripts compose these to build complex scenarios
- Provides maximum flexibility for different rebase scenarios

### Task Isolation

- Each task gets its own git repository in `task1/`, `task2/`, etc.
- Task directories are gitignored from the workshop repository
- Participants never modify the workshop repo itself

## Current Structure

```text
git-workshop/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts           # Entry point, re-exports all public APIs
â”‚   â”œâ”€â”€ operations.ts      # createGitOps() - factory for atomic operations
â”‚   â”œâ”€â”€ init.ts            # initTaskRepo() - creates/manages task repos
â”‚   â”œâ”€â”€ utils.ts           # hasFlag(), getTaskPath()
â”‚   â”œâ”€â”€ constants.ts       # CLI_FLAGS and other constants
â”‚   â”œâ”€â”€ types.ts           # Exported TypeScript interfaces
â”‚   â””â”€â”€ tasks/             # Task setup scripts
â”‚       â”œâ”€â”€ task1/
â”‚       â”‚   â””â”€â”€ index.ts   # Git configuration & setup (empty repo)
â”‚       â”œâ”€â”€ task2/
â”‚       â”‚   â””â”€â”€ index.ts   # Simple fast-forward rebase
â”‚       â””â”€â”€ task3/
â”‚           â””â”€â”€ index.ts   # Merge conflicts & rerere
â”œâ”€â”€ task1/                 # Generated by npm run task:1
â”‚   â”œâ”€â”€ .git/
â”‚   â””â”€â”€ Instructions.md   # Static file with exercise instructions
â”œâ”€â”€ task2/                 # Generated by npm run task:2
â”‚   â”œâ”€â”€ .git/
â”‚   â””â”€â”€ Instructions.md   # Static file with exercise instructions
â”œâ”€â”€ task3/                 # Generated by npm run task:3
â”‚   â”œâ”€â”€ .git/
â”‚   â””â”€â”€ Instructions.md   # Static file with exercise instructions
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ WORKSHOP_CONTEXT.md # This file
â”œâ”€â”€ README.md              # Participant-facing entry point
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ .gitignore            # Excludes task*/, node_modules/, dist/
â””â”€â”€ CLAUDE.md             # Development guide for Claude
```

## Available Operations

### Branch Operations

- `createBranch(name)` - Create and checkout new branch
- `switchBranch(name)` - Switch to existing branch
- `deleteBranch(name, force?)` - Delete branch
- `getCurrentBranch()` - Get current branch name
- `listBranches()` - List all branches

### File Operations

- `writeFile(path, content)` - Create or update file (automatically creates parent directories)
- `readFile(path)` - Read file content
- `deleteFile(path)` - Delete file
- `fileExists(path)` - Check if file exists

### Staging & Commits

- `addFiles(files)` - Stage specific files
- `addAll()` - Stage all changes
- `commit(message)` - Create commit
- `amendCommit(message?)` - Amend last commit

### Rebase & Merge

- `rebase(branch)` - Rebase onto branch
- `rebaseContinue()` - Continue rebase after resolving conflicts
- `rebaseAbort()` - Abort rebase
- `merge(branch)` - Merge branch
- `mergeAbort()` - Abort merge

### Rerere

- `enableRerere()` - Enable rerere
- `disableRerere()` - Disable rerere
- `isRerereEnabled()` - Check rerere status
- `clearRerereCache()` - Clear rerere cache

### Repository Info

- `getStatus()` - Get git status
- `getLog(maxCount?)` - Get commit log
- `hasConflicts()` - Check for conflicts
- `getConflictedFiles()` - List conflicted files
- `reset(mode, ref?)` - Reset repository

## Completed Tasks

### Task 1: Git Configuration & Setup

**File**: `src/tasks/task1/index.ts`
**Instructions**: `task1/Instructions.md` (static file)
**Scenario**: Git repository with sample commit history including branching and merging
**Learning Focus**: 

- Local vs global Git configuration
- Git aliases and workflow customization
- GitHub CLI basics
- Git worktrees
- Cross-platform Git settings (line endings, file modes)
- Exploring commit history with git log
**Generated Files**: All sample files created in `_sample/` directory
**Status**: âœ… Complete

### Task 2: Simple Fast-Forward Rebase

**File**: `src/tasks/task2/index.ts`
**Instructions**: `task2/Instructions.md` (static file)
**Scenario**: Feature branch with commits, main branch advances, participant rebases feature onto updated main
**Learning Focus**:

- Understanding what rebase does
- Visualizing branch history with git log
- Basic rebase workflow
- Fast-forward vs non-fast-forward scenarios
**Generated Files**: All sample files created in `_sample/` directory
**Status**: âœ… Complete

### Task 3: Merge Conflicts and Rerere

**File**: `src/tasks/task3/index.ts`
**Instructions**: `task3/Instructions.md` (static file)
**Scenario**: Feature branch with 4 conflicts across 2 commits (2 conflicts per commit); participants use `git rebase --abort` to experience repeated conflicts before enabling rerere
**Learning Focus**:

- Handling merge conflicts during rebase
- Understanding conflict markers
- Using `git rebase --abort` to bail out
- What is rerere (reuse recorded resolution)
- When to enable/disable rerere
- Experiencing repeated conflicts manually vs with rerere
**Workflow**:
- Rebase, resolve first commit's conflicts, continue
- Second commit shows more conflicts, then abort
- Rebase again (same conflicts appear - tedious!)
- Abort, enable rerere, rebase again (recorded)
- Abort and rebase final time (auto-resolved!)

**Generated Files**: All sample files created in `_sample/` directory
**Status**: âœ… Complete

### Task 4: Interactive Rebase Basics

**File**: `src/tasks/task4/index.ts`
**Instructions**: `task4/Instructions.md` (static file)
**Scenario**: Feature branch with 6 commits that need cleanup using fixup, reword, and squash
**Learning Focus**:

- Introduction to interactive rebase (`git rebase -i`)
- Using `fixup` to combine commits
- Using `reword` to edit commit messages
- Using `squash` to combine commits with merged messages
**Generated Files**: All sample files created in `_sample/` directory
**Status**: âœ… Complete

### Task 5: Interactive Rebase - Reordering and Removing Commits

**File**: `src/tasks/task5/index.ts`
**Instructions**: `task5/Instructions.md` (static file)
**Scenario**: Feature branch with 6 commits implementing user CRUD; history has misplaced commits and junk that needs cleanup
**Learning Focus**:

- Dropping unwanted commits using `drop` or line deletion
- Reordering commits by changing line order
- Combining reorder with fixup operations
- Understanding commit dependencies when reordering
- Planning complex interactive rebases
**Workflow**:
- Drop experimental commit ("Trying out something")
- Move fixup commit after its target and apply as fixup
- Move misplaced commit to end of history
- Verify final clean history

**Generated Files**: All sample files created in `_sample/` directory
**Status**: âœ… Complete

## Development Workflow

### Creating New Tasks

1. Create `src/tasks/taskN/index.ts`
2. Follow the standard pattern (see CLAUDE.md)
3. Create `taskN/Instructions.md` as a static file with exercise instructions
4. Add npm script to package.json: `"task:N": "ts-node src/tasks/taskN"`
5. Test with `npm run task:N`
6. Test force flag: `npm run task:N -- --force`
7. Update this context file with task details

### Instructions.md Pattern

- **Static files**: Instructions.md files are committed to the repository in `taskN/` directories
- **Not generated**: Task setup scripts do NOT create or modify Instructions.md
- **Content**: Step-by-step exercises, learning objectives, command reference, key takeaways
- **Format**: Markdown with code blocks, clear section headings, progressive difficulty
- **Purpose**: Decouple task setup (TypeScript) from participant guidance (Markdown)
- **Ending sections**: Instructions should end with "Key Takeaways" and "Common Commands Reference"
- **No forward-looking content**: Do NOT add "Next Steps" or "In future tasks..." sections at the end

### Testing Tasks

- Run setup script: `npm run task:N`
- Navigate to task directory: `cd taskN`
- Read Instructions.md: `cat Instructions.md` or open in editor
- Verify git state: `git log --oneline --graph --all`
- Follow participant instructions to test the scenario
- Use `--force` flag to reset and test again

## Key Implementation Details

### Repository Initialization

- `initTaskRepo()` checks if `.git/` directory exists (not just task folder)
- If `.git/` exists and no `--force`: throws error with helpful message
- If `.git/` exists and `--force`: deletes `.git/` and generated files, preserves Instructions.md
- Always creates fresh git repo with main branch
- Sets default git user (Rebase Wizard ðŸ§™)
- Automatically preserves `Instructions.md` during force reinitialization

### Force Flag Behavior

- Parsed from `process.argv` via `hasFlag(CLI_FLAGS.FORCE)`
- When true: deletes `.git/` directory and all generated files
- Automatically preserves `Instructions.md` and other specified files
- Warning shown about data loss
- Ensures idempotent task setup
- Simplified logic: only checks for `.git/` existence, not entire directory

### Logging Philosophy

- Operations log success with âœ“ prefix
- Setup phases use emoji (ðŸš€, ðŸ“, ðŸŒ²)
- Final state shown with ðŸ“Š
- Completion message directs to Instructions.md with ðŸ“–
- Makes script output easy to follow

## Dependencies

- `simple-git` - Git operations wrapper
- `typescript` - TypeScript compiler
- `ts-node` - Direct TypeScript execution
- `@types/node` - Node.js type definitions

## Git Configuration

Every task repo is initialized with:

- `user.name`: "Rebase Wizard ðŸ§™"
- `user.email`: rebase.the.blue@middleearth.com
.dev>"
- Default branch: `main`

## Notes

- Task repositories are excluded from version control via .gitignore
- Each task script is a standalone executable
- No build step required (ts-node executes directly)
- Workshop repo itself should remain clean (only task scripts, no generated repos)
- **File Organization Convention**: All generated sample files are placed in `_sample/` directory within each task to keep the repository root clean and make it clear which files are for learning purposes
- **Instructions.md**: Static files committed to repository, preserved during `--force` reinitialization
